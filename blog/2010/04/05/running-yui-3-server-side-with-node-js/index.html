<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta name="viewport" content="width=960" id="meta-viewport">
    <script>
    if (screen.width < 768) {
        document.getElementById('meta-viewport').setAttribute('content', 'width=768');
    }
    </script>



	<title>Running YUI 3 Server-Side with Node.js</title>

	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

	<!-- IMPORT: yuilibrary.com -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic">
	<link rel="stylesheet" type="text/css" href="/vendor/yui/cssgrids-min.css">
	<link rel="stylesheet" type="text/css" href="/combo/main-min.css">
	<link rel="stylesheet" type="text/css" href="/vendor/prettify/prettify-min.css">
	<link rel="stylesheet" type="text/css" href="/css/docs-min.css">

	<link rel="stylesheet" href="/css/blog.css" type="text/css" />


    <!-- GOOGLE ANALYTICS SCRIPT.
        When changing themes, be sure to copy/paste this script from this theme to the new theme.
    -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-34018865-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

</head>

<body class="single single-post postid-5469 single-format-standard yui3-skin-sam">

	<div id="doc">
	      <div id="hd" class="yui3-g">
		</div>
		<div id="bd" class="clearfix yui3-g">

		<div class="yui3-u-3-4" class="post-5469 post type-post status-publish format-standard hentry category-development category-performance" id="post-5469">

			<div class="content">


				<ul class="breadcrumbs">
                    <li class="front_page"><a href="//yuilibrary.com/">YUI</a></li>
                    <li><a href="/">Blog</a></li>
                    <li><a href="/blog/category/development/">Development</a></li>
                    <li class="current">Running YUI 3 Server-Side with Node.js</li></ul>
				<h1 class="yui3-u-7-8">Running YUI 3 Server-Side with Node.js</h1>

				<div class="entry yui3-u-1">
					<div class="meta">
    <img src="https://www.gravatar.com/avatar/d011327f5a3d4f1dc4215968e2bfd524?s=32"> <div class="cont"><a href="http://developer.yahoo.com/yui/" class="name">By YUI Team</a><span class="date">April 5, 2010<span></div></div>

<div class="blog" id="blog-content">
	<p>For those that do not know about <a href="http://nodejs.org/">Node.js</a>, here is how I describe it:<blockquote>Node.js is a server-side, non-blocking, event-driven runtime for JavaScript built on top of the <a href="http://code.google.com/p/v8/">v8 JavaScript engine</a>. Think of Node.js as a viable replacement for your server-side scripting language, sitting behind an http server like <a href="http://httpd.apache.org/">Apache</a> or <a href="http://nginx.org/">nginx</a>.</blockquote> <p>Recently I've been playing around with Node.js to see what all the excitement was about. So naturally I set out to see what it would take to get <a href="http://developer.yahoo.com/yui/3/" title="YUI 3 — Yahoo! User Interface Library">YUI 3</a> to run under Node. Knowing <a href="http://developer.yahoo.com/yui/theater/video.php?v=desai-yui3" title="Video: Satyen Desai — YUI3: Design Goals and Architecture (YUI Theater)">the architecture behind YUI 3</a>, I figured that it wouldn't be too hard to get it running.<p>Since Node.js does not provide a native DOM, you might wonder, "Why use a JavaScript framework?" Well, YUI 3 is not all about DOM manipulation &mdash; it also contains a robust set of class/object management tools, not to mention our powerful custom events. All of these tools are immediately useful in server-side programming.<h3>Getting Started</h3>
	<p>First, it should be noted that YUI will be loaded into the global scope in Node.js, because all YUI 3 modules invoke <code>YUI.add</code> at the start of the file. The YUI object will assign itself to the <code>exports</code> object per the <a href="http://commonjs.org/" title="CommonJS: JavaScript Standard Library">CommonJS</a> specification, but, once a module is used, it needs a global YUI to attach to. (This may be something we work around in the future, but that's the starting point for this exploration.)<p>The first thing I needed to do was get loader to work. Doing this was pretty simple, I just used the built-in YUI 3 tools. The YUI 3 module system is robust and easy to configure, so using the <code>YUI.add</code> method I was able to create a new <code>get</code> module. This new module accepted the default parameters for the client-side Get Utility, but instead of creating a script node and including YUI that way it fetches YUI from disk or from the CDN and loads the data into the current process. Here is a simple code snippet that shows how this is done:<pre>
YUI.add('get', function(Y) {
    Y.Get = function() {};
    Y.Get.script = function(s, cb) {
        var urls = Y.Array(s), url, i, l = urls.length;
        for (i=0; i &lt; l; i++) {
            url = urls[i];
            if (!urls[i].match(/^https?:\/\//)) {
                url = url.replace(/\.js$/, '');
            }
            Y.log('URL: ' + url, 'info', 'get');
            // doesn't need to be blocking, so don't block.
            require.async(url, function (mod) {
                pass(cb);
            });
        }
    };
    //Just putting this is so we don't get errors
    Y.Get.css = function(s, cb) {
        Y.log('Loading CSS: ' + s, 'debug', 'get');
        pass(cb);
    };
});
</pre><p>Now that I had Get loading scripts, I wanted to be able to track what it was doing. YUI 3 includes a configuration attribute called <code>logFn</code> that allows for logging support in environments where native console logging might not exist. I used this configuration attribute to add an option to the global YUI object that tells YUI that it should use a special function when emitting log messages. Here's a look at that function:<pre>
logFn: function(str, t, m) {
    t = t || 'info';
    m = (m) ? '(' +  m+ ') ' : '';
    var o = false;
    if (str instanceof Object || str instanceof Array) {
        //Should we use this?
        if (str.toString) {
            str = str.toString();
        } else {
            str = sys.inspect(str);
        }
    }
    // output log messages to stderr
    sys.error('[' + t.toUpperCase() + ']: ' + m + str);
}
</pre><p>Now that I had YUI 3 loading and logging messages, the next step was to test the system. I decided to load up my <a href="http://yuilibrary.com/gallery/show/yql" title="YUI Library :: Gallery :: YQL Query">YQL Gallery module</a> and try making a <a href="http://developer.yahoo.com/yql/" title="Yahoo! Query Language - YDN">YQL</a> request. This turned out to be easier than I expected. Since the YQL module uses Get, it worked out of the box. Here's a sample console printout of it running a YQL query against my GitHub table.<pre>
[INFO]: (yui) Module requirements: [ Array ]: 3
[INFO]: (yui) Modules missing: [ Array ]: 3, 3
[INFO]: (yui) Fetching loader: http://yui......oader/loader-min.js
[INFO]: (get) URL: http://yui.yahooapis.co.../loader/loader-min.js
[INFO]: (yui) Module requirements: [ Array ]: 11
[INFO]: (yui) Modules missing: [ Array ]: 8, 8
[INFO]: (yui) Using Loader
[INFO]: (get) URL: http://yui.yahooapis.com/combo?3.1.0/build/du......
...........ild/gallery-yql/gallery-yql-debug.js
[LIFE]: (base) constructor called
[INFO]: (attribute) Attribute constructor called
[LIFE]: (base) init called
[INFO]: (event) yui_3_1_0_1_12703536585676: Firing one:init
[INFO]: (attribute) initValue for initialized:false
[INFO]: (attribute) Adding attribute: initialized
[INFO]: (attribute) initValue for destroyed:false
[INFO]: (attribute) Adding attribute: destroyed
[INFO]: (attribute) Adding attribute: initialized
[INFO]: (event) : Firing one:foo
[INFO]: (event) : one:foo->sub: yui_3_1_0_1_127035365856711
[DEBUG]: (myapp) Foo Fired
[INFO]: (get) URL: http://query.yahooapis.com/v1/public/yql?q=select%20*%20fro.......bles.env&
[INFO]: (event) yui_3_1_0_1_127035365856715: query->sub: yui_3_1_0_1_127035365856716
{ count: '1'
, created: '2010-04-04T04:01:00Z'
, lang: 'en-US'
, updated: '2010-04-04T04:01:00Z'
, uri: 'http://query.yahooapis.com/v1/yql
, results: 
   { user: 
      { 'gravatar-id': 'd5c18055c50c5b34b0163e0bf0dbf59f'
      , name: 'Dav Glass'
      , company: [Object]
      .....
      , blog: 'http://blog.davglass.com/'
      }
   }
}
</pre><p>So with all that working as easy as it did, I figured it was time to see about adding support for <a href="http://developer.yahoo.com/yui/3/io/" title="YUI 3: IO">YUI 3 IO</a>. YUI 3's IO module already had support for cross domain requests via a Flash transport. I decided that I would add a new transport just for Node.js. Thomas Sha, the author of IO, was able to make IO accept third-party transports in the same fashion that the Flash transport works. At this point it was easy to integrate with the http connection handling already provided by Node.js. This allows code that designed to run on the XDR transport in the browser to be run on the server &mdash; all you need to do is change the transport type, and everything else should work exactly the same.<pre>
YUI().use('json', 'base', 'io-nodejs', function(Y) {
    var url = 'http:/'+'/yuilibrary.com/gallery/api/user/davglass';
    Y.io(url, {
        xdr: {
            use: 'nodejs'
        },
        on: {
            start: function() {
                Y.log('Start IO', 'info', 'TEST');
            },
            success: function(id, o) {
                Y.log(Y.JSON.parse(o.responseText).userinfo);
            }
        }
    });
</pre><p>After getting the IO module to work, I set out to use the library to build something fun. What did I build? I used YUI 3 and Node.js to build a local combo server. In other words, I could use YUI 3 to build a tool that serves YUI 3 combo'd files. This project was surprisingly easy to do as well. The source for the Combo Loader is available from <a href="http://github.com/davglass/nodejs-yui3loader">my GitHub account</a> and I have a <a href="http://yuiloader.davglass.com:8080/demo/">demo server up here</a>.<p>All in all, the process of making the core YUI 3 utilities work under Node.js was simple thanks to YUI 3's architecture. The code for my <a href="http://github.com/davglass/nodejs-yui3">Node.js YUI 3 module is available in my GitHub repository</a> with instructions on how to get it running.<p>Stay tuned for my next post, when I will talk about some additional experiments I've been pursuing since getting YUI 3 running on Node.js.</div>



	<div class="navigation">
		<div class="next-posts"></div>
		<div class="prev-posts"></div>
	</div>


			</div>
		</div>
    </div>




<div id="sidebar" class="yui3-u-1-4"><div class="liner">

        <div id="recent-posts-3" class="sidebox widget widget_recent_entries">		<div class="hd"><h2>Recent Posts</h2></div><div class="bd">		<ul>
					<li>
				<a href="/blog/2014/08/25/weve-moved-to-tumblr/">We’ve Moved to Tumblr!</a>
						</li>
					<li>
				<a href="/blog/2014/06/16/yui-gallery-deprecation-announcement/">YUI Gallery Deprecation Announcement</a>
						</li>
					<li>
				<a href="/blog/2014/06/03/yui-3-17-2-released/">YUI 3.17.2 Released</a>
						</li>
					<li>
				<a href="/blog/2014/05/23/yui-3-17-2-release-candidate-1/">YUI 3.17.2 Release Candidate 1</a>
						</li>
					<li>
				<a href="/blog/2014/05/21/yui-3-17-1-released/">YUI 3.17.1 Released</a>
						</li>
				</ul>
		</div></div><div id="archives-3" class="sidebox widget widget_archive"><div class="hd"><h2>Archives</h2></div><div class="bd">		<select name="archive-dropdown" onchange='document.location.href=this.options[this.selectedIndex].value;'>
			<option value="">Select Month</option>

				<option value='/blog/2014/08/'> August 2014 </option>
	<option value='/blog/2014/06/'> June 2014 </option>
	<option value='/blog/2014/05/'> May 2014 </option>
	<option value='/blog/2014/04/'> April 2014 </option>
	<option value='/blog/2014/03/'> March 2014 </option>
	<option value='/blog/2014/02/'> February 2014 </option>
	<option value='/blog/2014/01/'> January 2014 </option>
	<option value='/blog/2013/12/'> December 2013 </option>
	<option value='/blog/2013/11/'> November 2013 </option>
	<option value='/blog/2013/10/'> October 2013 </option>
	<option value='/blog/2013/09/'> September 2013 </option>
	<option value='/blog/2013/08/'> August 2013 </option>
	<option value='/blog/2013/07/'> July 2013 </option>
	<option value='/blog/2013/06/'> June 2013 </option>
	<option value='/blog/2013/05/'> May 2013 </option>
	<option value='/blog/2013/04/'> April 2013 </option>
	<option value='/blog/2013/03/'> March 2013 </option>
	<option value='/blog/2013/02/'> February 2013 </option>
	<option value='/blog/2013/01/'> January 2013 </option>
	<option value='/blog/2012/12/'> December 2012 </option>
	<option value='/blog/2012/11/'> November 2012 </option>
	<option value='/blog/2012/10/'> October 2012 </option>
	<option value='/blog/2012/09/'> September 2012 </option>
	<option value='/blog/2012/08/'> August 2012 </option>
	<option value='/blog/2012/07/'> July 2012 </option>
	<option value='/blog/2012/06/'> June 2012 </option>
	<option value='/blog/2012/05/'> May 2012 </option>
	<option value='/blog/2012/04/'> April 2012 </option>
	<option value='/blog/2012/03/'> March 2012 </option>
	<option value='/blog/2012/02/'> February 2012 </option>
	<option value='/blog/2012/01/'> January 2012 </option>
	<option value='/blog/2011/12/'> December 2011 </option>
	<option value='/blog/2011/11/'> November 2011 </option>
	<option value='/blog/2011/10/'> October 2011 </option>
	<option value='/blog/2011/09/'> September 2011 </option>
	<option value='/blog/2011/08/'> August 2011 </option>
	<option value='/blog/2011/07/'> July 2011 </option>
	<option value='/blog/2011/06/'> June 2011 </option>
	<option value='/blog/2011/05/'> May 2011 </option>
	<option value='/blog/2011/04/'> April 2011 </option>
	<option value='/blog/2011/03/'> March 2011 </option>
	<option value='/blog/2011/02/'> February 2011 </option>
	<option value='/blog/2011/01/'> January 2011 </option>
	<option value='/blog/2010/12/'> December 2010 </option>
	<option value='/blog/2010/11/'> November 2010 </option>
	<option value='/blog/2010/10/'> October 2010 </option>
	<option value='/blog/2010/09/'> September 2010 </option>
	<option value='/blog/2010/08/'> August 2010 </option>
	<option value='/blog/2010/07/'> July 2010 </option>
	<option value='/blog/2010/06/'> June 2010 </option>
	<option value='/blog/2010/05/'> May 2010 </option>
	<option value='/blog/2010/04/'> April 2010 </option>
	<option value='/blog/2010/03/'> March 2010 </option>
	<option value='/blog/2010/02/'> February 2010 </option>
	<option value='/blog/2010/01/'> January 2010 </option>
	<option value='/blog/2009/12/'> December 2009 </option>
	<option value='/blog/2009/11/'> November 2009 </option>
	<option value='/blog/2009/10/'> October 2009 </option>
	<option value='/blog/2009/09/'> September 2009 </option>
	<option value='/blog/2009/08/'> August 2009 </option>
	<option value='/blog/2009/07/'> July 2009 </option>
	<option value='/blog/2009/06/'> June 2009 </option>
	<option value='/blog/2009/05/'> May 2009 </option>
	<option value='/blog/2009/04/'> April 2009 </option>
	<option value='/blog/2009/03/'> March 2009 </option>
	<option value='/blog/2009/02/'> February 2009 </option>
	<option value='/blog/2009/01/'> January 2009 </option>
	<option value='/blog/2008/12/'> December 2008 </option>
	<option value='/blog/2008/11/'> November 2008 </option>
	<option value='/blog/2008/10/'> October 2008 </option>
	<option value='/blog/2008/09/'> September 2008 </option>
	<option value='/blog/2008/08/'> August 2008 </option>
	<option value='/blog/2008/07/'> July 2008 </option>
	<option value='/blog/2008/06/'> June 2008 </option>
	<option value='/blog/2008/05/'> May 2008 </option>
	<option value='/blog/2008/04/'> April 2008 </option>
	<option value='/blog/2008/03/'> March 2008 </option>
	<option value='/blog/2008/02/'> February 2008 </option>
	<option value='/blog/2008/01/'> January 2008 </option>
	<option value='/blog/2007/12/'> December 2007 </option>
	<option value='/blog/2007/11/'> November 2007 </option>
	<option value='/blog/2007/10/'> October 2007 </option>
	<option value='/blog/2007/09/'> September 2007 </option>
	<option value='/blog/2007/08/'> August 2007 </option>
	<option value='/blog/2007/07/'> July 2007 </option>
	<option value='/blog/2007/06/'> June 2007 </option>
	<option value='/blog/2007/05/'> May 2007 </option>
	<option value='/blog/2007/04/'> April 2007 </option>
	<option value='/blog/2007/03/'> March 2007 </option>
	<option value='/blog/2007/02/'> February 2007 </option>
	<option value='/blog/2007/01/'> January 2007 </option>
	<option value='/blog/2006/12/'> December 2006 </option>
	<option value='/blog/2006/11/'> November 2006 </option>
	<option value='/blog/2006/10/'> October 2006 </option>
	<option value='/blog/2006/09/'> September 2006 </option>
	<option value='/blog/2006/08/'> August 2006 </option>
	<option value='/blog/2006/07/'> July 2006 </option>
	<option value='/blog/2006/06/'> June 2006 </option>
	<option value='/blog/2006/05/'> May 2006 </option>
	<option value='/blog/2006/04/'> April 2006 </option>
	<option value='/blog/2006/03/'> March 2006 </option>
	<option value='/blog/2006/02/'> February 2006 </option>
		</select>
</div></div><div id="categories-2" class="sidebox widget widget_categories"><div class="hd"><h2>Categories</h2></div><div class="bd">		<ul>
	<li class="cat-item cat-item-69"><a href="/blog/category/accessibility/" >Accessibility</a> (25)
</li>
	<li class="cat-item cat-item-524"><a href="/blog/category/css-101/" >CSS 101</a> (8)
</li>
	<li class="cat-item cat-item-1"><a href="/blog/category/design/" title="This category is for design related posts. For example, all posts about the design pattern library belong here.">Design</a> (51)
</li>
	<li class="cat-item cat-item-2"><a href="/blog/category/development/" title="For development related posts, including all posts about the Yahoo! User Interface Library.">Development</a> (653)
</li>
	<li class="cat-item cat-item-219"><a href="/blog/category/frontend-engineering-jobs-at-yahoo/" >Frontend Jobs at Yahoo</a> (13)
</li>
	<li class="cat-item cat-item-96"><a href="/blog/category/graded-browser-support/" >Graded Browser Support</a> (8)
</li>
	<li class="cat-item cat-item-11"><a href="/blog/category/in-the-wild/" title="In which we mention and link to third-party tutorials, discussions, comments, feedback, and implementations.">In the Wild</a> (63)
</li>
	<li class="cat-item cat-item-403"><a href="/blog/category/miscellany/" >Miscellany</a> (13)
</li>
	<li class="cat-item cat-item-483"><a href="/blog/category/open-hours/" >Open Hours</a> (44)
</li>
	<li class="cat-item cat-item-13"><a href="/blog/category/performance/" >Performance</a> (23)
</li>
	<li class="cat-item cat-item-598"><a href="/blog/category/releases/" >Releases</a> (50)
</li>
	<li class="cat-item cat-item-592"><a href="/blog/category/target-environments/" >Target Environments</a> (11)
</li>
	<li class="cat-item cat-item-599"><a href="/blog/category/yeti-development/" >Yeti</a> (5)
</li>
	<li class="cat-item cat-item-292"><a href="/blog/category/yui-3-gallery/" >YUI 3 Gallery</a> (34)
</li>
	<li class="cat-item cat-item-286"><a href="/blog/category/yui-events/" >YUI Events</a> (48)
</li>
	<li class="cat-item cat-item-8"><a href="/blog/category/yui-implementations/" >YUI Implementations</a> (55)
</li>
	<li class="cat-item cat-item-9"><a href="/blog/category/yui-theater/" >YUI Theater</a> (164)
</li>
	<li class="cat-item cat-item-595"><a href="/blog/category/yui-weekly/" >YUI Weekly</a> (76)
</li>
	<li class="cat-item cat-item-602"><a href="/blog/category/yui-conf/" title="Posts pertaining to YUIConf - videos, notices, updates.">YUIConf</a> (27)
</li>
		</ul>
</div></div>

</div></div>
		</div><!-- /#bd -->
		<div id="ft">
			<footer>
				<div class="copyright">
			&copy; 2014 YUI Blog				</div>
			</footer></div></div><!-- /#doc -->

</body>
</html>
