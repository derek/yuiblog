<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta name="viewport" content="width=960" id="meta-viewport">
    <script>
    if (screen.width < 768) {
        document.getElementById('meta-viewport').setAttribute('content', 'width=768');
    }
    </script>



	<title>Node.js, YUI 3 &amp; Dom Manipulation... Oh My!</title>

	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

	<!-- IMPORT: yuilibrary.com -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic">
	<link rel="stylesheet" type="text/css" href="/vendor/yui/cssgrids-min.css">
	<link rel="stylesheet" type="text/css" href="/combo/main-min.css">
	<link rel="stylesheet" type="text/css" href="/vendor/prettify/prettify-min.css">
	<link rel="stylesheet" type="text/css" href="/css/docs-min.css">

	<link rel="stylesheet" href="/css/blog.css" type="text/css" />


    <!-- GOOGLE ANALYTICS SCRIPT.
        When changing themes, be sure to copy/paste this script from this theme to the new theme.
    -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-34018865-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

</head>

<body class="single single-post postid-5469 single-format-standard yui3-skin-sam">

	<div id="doc">
	      <div id="hd" class="yui3-g">
		</div>
		<div id="bd" class="clearfix yui3-g">

		<div class="yui3-u-3-4" class="post-5469 post type-post status-publish format-standard hentry category-development category-performance" id="post-5469">

			<div class="content">


				<ul class="breadcrumbs">
                    <li class="front_page"><a href="//yuilibrary.com/">YUI</a></li>
                    <li><a href="/">Blog</a></li>
                    <li><a href="/blog/category/development/">Development</a></li>
                    <li class="current">Node.js, YUI 3 &amp; Dom Manipulation... Oh My!</li></ul>
				<h1 class="yui3-u-7-8">Node.js, YUI 3 &amp; Dom Manipulation... Oh My!</h1>

				<div class="entry yui3-u-1">
					<div class="meta">
    <img src="https://www.gravatar.com/avatar/d011327f5a3d4f1dc4215968e2bfd524?s=32"> <div class="cont"><a href="http://developer.yahoo.com/yui/" class="name">By YUI Team</a><span class="date">April 9, 2010<span></div></div>

<div class="blog" id="blog-content">
	<p><em><strong>Update from <a href="/blog-archive/blog/2010/04/05/running-yui-3-server-side-with-node-js/" title="Running YUI 3 Server-Side with Node.js » Yahoo! User Interface Blog (YUIBlog)">the previous article</a></strong>: YUI 3 no longer runs in the global scope. I have made some adjustments to my <a href="http://github.com/davglass/nodejs-yui3">nodejs-yui3</a> project to allow YUI 3 to run fully as a proper non-global module.</em><p><a href="/blog-archive/blog/2010/04/05/running-yui-3-server-side-with-node-js/">Early this week</a> I gave you a peek at running <a href="http://developer.yahoo.com/yui/3/" title="YUI 3 — Yahoo! User Interface Library">YUI 3</a> on the server with <a href="http://nodejs.org/" title="node.js">Node.js</a>. Now I'm back to tell you what I have been up to over the last week or so. A couple of weeks ago I stumbled across a project on GitHub called <a href="http://github.com/tmpvar/jsdom">jsdom</a> by <a href="http://github.com/tmpvar">Elijah Insua</a> (<a href="http://twitter.com/tmpvar">@tmpvar</a>). jsdom describes itself as:<blockquote>
			<p>[A] <a href="http://commonjs.org/" title="CommonJS: JavaScript Standard Library">CommonJS</a> implementation of the DOM intended to be platform-independent and as minimal/light as possible while completely adhering to the w3c DOM specifications.</blockquote> <p>That sounded interesting to me, so I forked the repository and started playing around with it to see what I could get it to do. To my surprise, it just worked. And because it's written in JavaScript, it was easy to start hacking and adding new features. The only issue I could see was that it's a pure DOM layer, lacking some BOM features that are necessary for most common web application development. So I set out to add the features I would need to run YUI 3 against jsdom. After a couple of days of hacking, I had a baseline implementation of jsdom that supports almost all of YUI 3's needs.<h3>Getting YUI 3 running with jsdom</h3>
	<p>I started by just including <a href="http://github.com/tmpvar/jsdom">jsdom</a> and setting up the "fake" document object. At this point I could load our core <a href="http://developer.yahoo.com/yui/3/node/" title="YUI 3: Node">YUI 3 DOM functionality</a>, but the Event module would't load. That's when I noticed that some key BOM abstractions were missing &mdash; for example, Event needs some kind of a <code>window</code> object. So I created a "fake" window object to match my "fake" document and things started to load. As I said in the previous article, YUI 3's module system is fantastic and makes this kind of work much easier to do.<p>Most scripts access <code>document</code> and <code>window</code> directly. YUI 3 doesn't do that; instead, we have references to the active document/window in a config attached to each YUI instance. These can be accessed by <code>Y.config.doc</code> and <code>Y.config.win</code>. All YUI 3 modules adhere to this practice (and we strongly recommend you do the same in your <a href="http://yuilibrary.com/gallery/" title="YUI Library :: Gallery">YUI 3 Gallery</a> modules or your own bespoke components).<p>Some might think this is a little excessive, but I've already used this feature in my early work on Editor for YUI 3. I am able to create a YUI instance and have it bound to an iframe's window/document. This means that I can run Selector and Event inside the iframe without having to load YUI inside that document. On the server, this makes even more sense. You may have several documents open in the same process, but your YUI 3 instances only need to know about the document they're using.<p>To support this work, I've created a new YUI 3 module called <code>nodejs-dom</code>. This module will include the proper libraries, if available, and set up the YUI instance with a <code>document</code> and <code>window</code> reference. Along with the configuration, it will create a new object on the instance called <code>Browser</code>. Since all YUI 3 module use Node and Node uses <code>Y.config.doc</code>, you shouldn't need to do anything else to make YUI 3 code work on the server. But if you're working with older JavaScript and need to access the <code>document</code>, <code>window</code>, <code>location</code> or <code>navigator</code> objects, they're all available on the <code>Browser</code> object. Here's a quick view of what the <code>Y.Browser</code> object looks like:<pre>
{navigator: 
   { userAgent: 'Node.js (darwin; U; rv:0.1.33)'
   , appVersion: '0.1.33'
   , platform: 'darwin'
   }
, window: 
   { screenTop: 0
   , pageYOffset: 0
   , screenY: 0
   , navigator: [Circular]
   , innerHeight: 768
   , pageXOffset: 0
   , screenLeft: 0
   , screenX: 0
   , innerWidth: 1024
   , length: 1
   , scrollY: 0
   , outerHeight: 768
   , contentWindow: [Circular]
   , frames: [ [Circular], [length]: 1 ]
   , setInterval:  [Function]
   , name: 'nodejs'
   , scrollX: 0
   , document: '#DOCUMENT'
   , outerWidth: 1024
   , setTimeout: { [Function]
   , location: { href: '/Users/davglass/.node_libraries/browser.js' }
   }
, self: [Circular]
, document: [Circular]
, location: [Circular]
}
</pre><h3>innerHTML support</h3>
	<p>Since <code>innerHTML</code> is not in the DOM Level1 spec, it's not in jsdom. This was a requirement for me, so I needed to find a solution. I found a project on GitHub called <a href="http://github.com/tautologistics/node-htmlparser">node-htmlparser</a> and it claimed to be able to parse HTML, including malformed syntax. <a href="http://github.com/davglass/node-htmlparser">I forked it</a> and made some code changes, cleaned up the syntax and fixed a couple of issues. I'd recommend using my fork if you're following along at home; I know my fork will work and I'll continue to maintain it as long as needed. Eventually someone will write a parser based on <a href="http://twitter.com/izs">@izs</a>'s <a href="http://github.com/isaacs/sax-js">sax-js</a> module.<h3>Let's see some code</h3>
	<p>This is a very simple hello world example:<pre>
YUI().use('nodejs-dom', 'event', 'node', function(Y) {
    var document = Y.Browser.document;
    document.title = 'This is a test';
    var i = Y.Node.create('&lt;i&gt;Test This&lt;/i&gt;');
    i.addClass('foo');
    Y.one('body').append(i);

    var div = document.createElement('div');
    div.id = 'foo';
    div.innerHTML = '&lt;em id="foo"&gt;Test&lt;/em&gt; this &lt;strong id="bax"&gt;awesome!&lt;/strong&gt;';
    document.body.appendChild(div);
    
    var foo = Y.one('#foo');
    foo.addClass('bar');
    sys.puts(document.outerHTML);
});
</pre><p>The above code will return this snippet of HTML:<pre>
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;This is a test&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;i class="foo"&gt;Test This&lt;/i&gt;
    &lt;div id="foo" class="bar"&gt;
      &lt;em id="foo"&gt;Test&lt;/em&gt; this &lt;strong id="bax"&gt;awesome!&lt;/strong&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre><h3>Is that what I think it is?</h3>
	<p>That's the most common question I've received when showing demos of this stuff. The answer: <strong>YES</strong>, this is what you think it is: <strong>a full document rendered on the server by writing standard JavaScript against standard DOM and BOM APIs</strong>. I have several examples of its use in the <a href="http://github.com/davglass/nodejs-yui3">GitHub project</a>. These examples include rendering YUI 3 <a href="http://developer.yahoo.com/yui/3/tabview">Tabviews</a>, <a href="http://developer.yahoo.com/yui/3/slider">Sliders</a> and <a href="http://developer.yahoo.com/yui/3/overlay">Overlays</a>. Using the <a href="/blog-archive/blog/2010/03/11/yui-2-in-3-coming-soon/">2 in 3</a> project I was also able to render a YUI 2 <a href="http://developer.yahoo.com/yui/calendar">Calendar</a> and <a href="http://developer.yahoo.com/yui/layout">Layout Manager</a>.<h3>Examples</h3>
	<p>I tossed up a couple of the examples from my git repo so you can see them in action:<ul>
			<li><a href="http://yuiloader.davglass.com/calendar/">Functional YUI 2 Calendar rendered server-side</a> (<a href="http://github.com/davglass/nodejs-yui3/blob/master/examples/tnt-calendar-serve.js">source</a>)<li><a href="http://yuiloader.davglass.com/template/">Simple Templating Demo</a> (<a href="http://github.com/davglass/nodejs-yui3/blob/master/examples/y-server-template.js">source</a>)</ul> <p>The Calendar demo is designed to show an example of progressive enhancement by using YUI to generate the Calendar on the server and provide static navigation to selected days and months. This implementation uses the same JavaScript to generate the server-side view as you would use on the client to render it in pure JavaScript. There is intentionally no client side JavaScript. Think of this as the baseline you'd use for progressive enhancement, rendering a fully-functional DOM on the server side to provide functionality to clients with no JavaScript support.<p>The second example shows how you can mix and match what is server data and what is client data. If I have a true MVC framework, which YUI 3 provides, I can separate my data (JSON) from my widget templates (DHTML) and from page templates (static HTML). The example shows how you can use the same data but access it from 3 different places to get only the parts you want.<p>I hope you see the power here that I see, including a possible future free of context switching and free of writing multiple levels of rendering code in the various levels of an application to support progressive enhancement. Enjoy! (<a href="http://twitter.com/davglass">@davglass</a>)</div>



	<div class="navigation">
		<div class="next-posts"></div>
		<div class="prev-posts"></div>
	</div>


			</div>
		</div>
    </div>




<div id="sidebar" class="yui3-u-1-4"><div class="liner">

        <div id="recent-posts-3" class="sidebox widget widget_recent_entries">		<div class="hd"><h2>Recent Posts</h2></div><div class="bd">		<ul>
					<li>
				<a href="/blog/2014/08/25/weve-moved-to-tumblr/">We’ve Moved to Tumblr!</a>
						</li>
					<li>
				<a href="/blog/2014/06/16/yui-gallery-deprecation-announcement/">YUI Gallery Deprecation Announcement</a>
						</li>
					<li>
				<a href="/blog/2014/06/03/yui-3-17-2-released/">YUI 3.17.2 Released</a>
						</li>
					<li>
				<a href="/blog/2014/05/23/yui-3-17-2-release-candidate-1/">YUI 3.17.2 Release Candidate 1</a>
						</li>
					<li>
				<a href="/blog/2014/05/21/yui-3-17-1-released/">YUI 3.17.1 Released</a>
						</li>
				</ul>
		</div></div><div id="archives-3" class="sidebox widget widget_archive"><div class="hd"><h2>Archives</h2></div><div class="bd">		<select name="archive-dropdown" onchange='document.location.href=this.options[this.selectedIndex].value;'>
			<option value="">Select Month</option>

				<option value='/blog/2014/08/'> August 2014 </option>
	<option value='/blog/2014/06/'> June 2014 </option>
	<option value='/blog/2014/05/'> May 2014 </option>
	<option value='/blog/2014/04/'> April 2014 </option>
	<option value='/blog/2014/03/'> March 2014 </option>
	<option value='/blog/2014/02/'> February 2014 </option>
	<option value='/blog/2014/01/'> January 2014 </option>
	<option value='/blog/2013/12/'> December 2013 </option>
	<option value='/blog/2013/11/'> November 2013 </option>
	<option value='/blog/2013/10/'> October 2013 </option>
	<option value='/blog/2013/09/'> September 2013 </option>
	<option value='/blog/2013/08/'> August 2013 </option>
	<option value='/blog/2013/07/'> July 2013 </option>
	<option value='/blog/2013/06/'> June 2013 </option>
	<option value='/blog/2013/05/'> May 2013 </option>
	<option value='/blog/2013/04/'> April 2013 </option>
	<option value='/blog/2013/03/'> March 2013 </option>
	<option value='/blog/2013/02/'> February 2013 </option>
	<option value='/blog/2013/01/'> January 2013 </option>
	<option value='/blog/2012/12/'> December 2012 </option>
	<option value='/blog/2012/11/'> November 2012 </option>
	<option value='/blog/2012/10/'> October 2012 </option>
	<option value='/blog/2012/09/'> September 2012 </option>
	<option value='/blog/2012/08/'> August 2012 </option>
	<option value='/blog/2012/07/'> July 2012 </option>
	<option value='/blog/2012/06/'> June 2012 </option>
	<option value='/blog/2012/05/'> May 2012 </option>
	<option value='/blog/2012/04/'> April 2012 </option>
	<option value='/blog/2012/03/'> March 2012 </option>
	<option value='/blog/2012/02/'> February 2012 </option>
	<option value='/blog/2012/01/'> January 2012 </option>
	<option value='/blog/2011/12/'> December 2011 </option>
	<option value='/blog/2011/11/'> November 2011 </option>
	<option value='/blog/2011/10/'> October 2011 </option>
	<option value='/blog/2011/09/'> September 2011 </option>
	<option value='/blog/2011/08/'> August 2011 </option>
	<option value='/blog/2011/07/'> July 2011 </option>
	<option value='/blog/2011/06/'> June 2011 </option>
	<option value='/blog/2011/05/'> May 2011 </option>
	<option value='/blog/2011/04/'> April 2011 </option>
	<option value='/blog/2011/03/'> March 2011 </option>
	<option value='/blog/2011/02/'> February 2011 </option>
	<option value='/blog/2011/01/'> January 2011 </option>
	<option value='/blog/2010/12/'> December 2010 </option>
	<option value='/blog/2010/11/'> November 2010 </option>
	<option value='/blog/2010/10/'> October 2010 </option>
	<option value='/blog/2010/09/'> September 2010 </option>
	<option value='/blog/2010/08/'> August 2010 </option>
	<option value='/blog/2010/07/'> July 2010 </option>
	<option value='/blog/2010/06/'> June 2010 </option>
	<option value='/blog/2010/05/'> May 2010 </option>
	<option value='/blog/2010/04/'> April 2010 </option>
	<option value='/blog/2010/03/'> March 2010 </option>
	<option value='/blog/2010/02/'> February 2010 </option>
	<option value='/blog/2010/01/'> January 2010 </option>
	<option value='/blog/2009/12/'> December 2009 </option>
	<option value='/blog/2009/11/'> November 2009 </option>
	<option value='/blog/2009/10/'> October 2009 </option>
	<option value='/blog/2009/09/'> September 2009 </option>
	<option value='/blog/2009/08/'> August 2009 </option>
	<option value='/blog/2009/07/'> July 2009 </option>
	<option value='/blog/2009/06/'> June 2009 </option>
	<option value='/blog/2009/05/'> May 2009 </option>
	<option value='/blog/2009/04/'> April 2009 </option>
	<option value='/blog/2009/03/'> March 2009 </option>
	<option value='/blog/2009/02/'> February 2009 </option>
	<option value='/blog/2009/01/'> January 2009 </option>
	<option value='/blog/2008/12/'> December 2008 </option>
	<option value='/blog/2008/11/'> November 2008 </option>
	<option value='/blog/2008/10/'> October 2008 </option>
	<option value='/blog/2008/09/'> September 2008 </option>
	<option value='/blog/2008/08/'> August 2008 </option>
	<option value='/blog/2008/07/'> July 2008 </option>
	<option value='/blog/2008/06/'> June 2008 </option>
	<option value='/blog/2008/05/'> May 2008 </option>
	<option value='/blog/2008/04/'> April 2008 </option>
	<option value='/blog/2008/03/'> March 2008 </option>
	<option value='/blog/2008/02/'> February 2008 </option>
	<option value='/blog/2008/01/'> January 2008 </option>
	<option value='/blog/2007/12/'> December 2007 </option>
	<option value='/blog/2007/11/'> November 2007 </option>
	<option value='/blog/2007/10/'> October 2007 </option>
	<option value='/blog/2007/09/'> September 2007 </option>
	<option value='/blog/2007/08/'> August 2007 </option>
	<option value='/blog/2007/07/'> July 2007 </option>
	<option value='/blog/2007/06/'> June 2007 </option>
	<option value='/blog/2007/05/'> May 2007 </option>
	<option value='/blog/2007/04/'> April 2007 </option>
	<option value='/blog/2007/03/'> March 2007 </option>
	<option value='/blog/2007/02/'> February 2007 </option>
	<option value='/blog/2007/01/'> January 2007 </option>
	<option value='/blog/2006/12/'> December 2006 </option>
	<option value='/blog/2006/11/'> November 2006 </option>
	<option value='/blog/2006/10/'> October 2006 </option>
	<option value='/blog/2006/09/'> September 2006 </option>
	<option value='/blog/2006/08/'> August 2006 </option>
	<option value='/blog/2006/07/'> July 2006 </option>
	<option value='/blog/2006/06/'> June 2006 </option>
	<option value='/blog/2006/05/'> May 2006 </option>
	<option value='/blog/2006/04/'> April 2006 </option>
	<option value='/blog/2006/03/'> March 2006 </option>
	<option value='/blog/2006/02/'> February 2006 </option>
		</select>
</div></div><div id="categories-2" class="sidebox widget widget_categories"><div class="hd"><h2>Categories</h2></div><div class="bd">		<ul>
	<li class="cat-item cat-item-69"><a href="/blog/category/accessibility/" >Accessibility</a> (25)
</li>
	<li class="cat-item cat-item-524"><a href="/blog/category/css-101/" >CSS 101</a> (8)
</li>
	<li class="cat-item cat-item-1"><a href="/blog/category/design/" title="This category is for design related posts. For example, all posts about the design pattern library belong here.">Design</a> (51)
</li>
	<li class="cat-item cat-item-2"><a href="/blog/category/development/" title="For development related posts, including all posts about the Yahoo! User Interface Library.">Development</a> (653)
</li>
	<li class="cat-item cat-item-219"><a href="/blog/category/frontend-engineering-jobs-at-yahoo/" >Frontend Jobs at Yahoo</a> (13)
</li>
	<li class="cat-item cat-item-96"><a href="/blog/category/graded-browser-support/" >Graded Browser Support</a> (8)
</li>
	<li class="cat-item cat-item-11"><a href="/blog/category/in-the-wild/" title="In which we mention and link to third-party tutorials, discussions, comments, feedback, and implementations.">In the Wild</a> (63)
</li>
	<li class="cat-item cat-item-403"><a href="/blog/category/miscellany/" >Miscellany</a> (13)
</li>
	<li class="cat-item cat-item-483"><a href="/blog/category/open-hours/" >Open Hours</a> (44)
</li>
	<li class="cat-item cat-item-13"><a href="/blog/category/performance/" >Performance</a> (23)
</li>
	<li class="cat-item cat-item-598"><a href="/blog/category/releases/" >Releases</a> (50)
</li>
	<li class="cat-item cat-item-592"><a href="/blog/category/target-environments/" >Target Environments</a> (11)
</li>
	<li class="cat-item cat-item-599"><a href="/blog/category/yeti-development/" >Yeti</a> (5)
</li>
	<li class="cat-item cat-item-292"><a href="/blog/category/yui-3-gallery/" >YUI 3 Gallery</a> (34)
</li>
	<li class="cat-item cat-item-286"><a href="/blog/category/yui-events/" >YUI Events</a> (48)
</li>
	<li class="cat-item cat-item-8"><a href="/blog/category/yui-implementations/" >YUI Implementations</a> (55)
</li>
	<li class="cat-item cat-item-9"><a href="/blog/category/yui-theater/" >YUI Theater</a> (164)
</li>
	<li class="cat-item cat-item-595"><a href="/blog/category/yui-weekly/" >YUI Weekly</a> (76)
</li>
	<li class="cat-item cat-item-602"><a href="/blog/category/yui-conf/" title="Posts pertaining to YUIConf - videos, notices, updates.">YUIConf</a> (27)
</li>
		</ul>
</div></div>

</div></div>
		</div><!-- /#bd -->
		<div id="ft">
			<footer>
				<div class="copyright">
			&copy; 2014 YUI Blog				</div>
			</footer></div></div><!-- /#doc -->

</body>
</html>
