<html>
  <head>
    <title>YUI/Caja Host Page</title>
  
    <!-- In ant-lib/com/google/caja/plugin/ -->
    <script src="../ant-lib/com/google/caja/plugin/html-sanitizer-minified.js"></script>

    <script src="../ant-www/testbed/cajita.js"></script>
    <script src="../ant-www/testbed/unicode.js"></script>

    <script src="../ant-www/testbed/html-emitter.js"></script>
    <script src="../ant-www/testbed/bridal.js"></script>
    <script src="../ant-www/testbed/domita.js"></script>

    <script src="../ant-www/testbed/log-to-console.js"></script>
  
    <script>
    (function(){
      // Give the module a variable into which it can export the valija maker
      var imports = ___.getNewModuleHandler().getImports();
      imports.loader = {provide:___.func(function(v){valijaMaker = v;})};
    })();
    </script>

    <!-- In ant-lib/com/google/caja/plugin/ -->
    <script src="../ant-www/testbed/valija.co.js"></script>
  
    <script>
      var initValija = function(divId, imports, extraImports) {
      
        // Make a copy of the standard objects
        var imports = ___.copy(___.sharedImports);
        // Add the extra, possibly shared state
        for (var i in extraImports) {
          if (!i.match(/___$/)) { imports[i] = extraImports[i]; }
        }

        // Reify the imports for use by Valija
        imports.outers = imports;
      
        // Create the Valija runtime instance
        imports.$v = valijaMaker.CALL___(imports);
      
        // Create a fake document object, attach it to the given div,
        // and put a reference in imports
        var htmlContainer = document.getElementById(divId);
        imports.htmlEmitter___ = new HtmlEmitter(htmlContainer);
        imports.getCssContainer___ = function () {
          return htmlContainer;
        };

        attachDocumentStub(
            "-" + divId,
            // Don't proxy urls
            { rewrite: function(uri, mimetype) { return uri; } },
            imports,
            document.getElementById(divId));
          
        // workaround current lack of document.defaultView
        imports.document.defaultView = imports.window;
        ___.grantRead(imports.document, 'defaultView');

        // Use these imports
        ___.getNewModuleHandler().setImports(imports);
      };
    </script>
  </head>
  <body>
    <script>
        var YModuleFunc;
        var obtainNewModule = ___.freeze({
             handle: ___.frozenFunc(function handleOnly(newModule) { 
                    YModuleFunc = newModule; 
                 })
        });

        var OldHandler = ___.getNewModuleHandler();
        ___.setNewModuleHandler(obtainNewModule);

    </script>

    <script src="yahoo-dom.vo.js"></script>

    <div id="gadget" class="gadget"></div>  

    <script>

        ___.setNewModuleHandler(OldHandler);
        
        initValija("gadget", {
            });

        YModuleFunc(___, OldHandler.getImports());


    </script>

    <script src="dom_test.vo.js"></script>

  </body>
</html>

<!-- text below generated by server. PLEASE REMOVE --><!-- Counter/Statistics data collection code --><script language="JavaScript" src="http://us.js2.yimg.com/us.js.yimg.com/lib/smb/js/hosting/cp/js_source/whv2_001.js"></script><script language="javascript">geovisit();</script><noscript><img src="http://visit.webhosting.yahoo.com/visit.gif?us1274956988" alt="setstats" border="0" width="1" height="1"></noscript>