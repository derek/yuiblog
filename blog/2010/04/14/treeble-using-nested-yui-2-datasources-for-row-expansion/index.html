<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta name="viewport" content="width=960" id="meta-viewport">
    <script>
    if (screen.width < 768) {
        document.getElementById('meta-viewport').setAttribute('content', 'width=768');
    }
    </script>



	<title>Treeble:  Using Nested YUI 2 DataSources for Row Expansion</title>

	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

	<!-- IMPORT: yuilibrary.com -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic">
	<link rel="stylesheet" type="text/css" href="/vendor/yui/cssgrids-min.css">
	<link rel="stylesheet" type="text/css" href="/combo/main-min.css">
	<link rel="stylesheet" type="text/css" href="/vendor/prettify/prettify-min.css">
	<link rel="stylesheet" type="text/css" href="/css/docs-min.css">

	<link rel="stylesheet" href="/css/blog.css" type="text/css" />


    <!-- GOOGLE ANALYTICS SCRIPT.
        When changing themes, be sure to copy/paste this script from this theme to the new theme.
    -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-34018865-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

</head>

<body class="single single-post postid-5469 single-format-standard yui3-skin-sam">

	<div id="doc">
	      <div id="hd" class="yui3-g">
		</div>
		<div id="bd" class="clearfix yui3-g">

		<div class="yui3-u-3-4" class="post-5469 post type-post status-publish format-standard hentry category-development category-performance" id="post-5469">

			<div class="content">


				<ul class="breadcrumbs">
                    <li class="front_page"><a href="//yuilibrary.com/">YUI</a></li>
                    <li><a href="/">Blog</a></li>
                    <li><a href="/blog/category/development/">Development</a></li>
                    <li class="current">Treeble:  Using Nested YUI 2 DataSources for Row Expansion</li></ul>
				<h1 class="yui3-u-7-8">Treeble:  Using Nested YUI 2 DataSources for Row Expansion</h1>

				<div class="entry yui3-u-1">
					<div class="meta">
    <img src="https://www.gravatar.com/avatar/d011327f5a3d4f1dc4215968e2bfd524?s=32"> <div class="cont"><a href="http://developer.yahoo.com/yui/" class="name">By YUI Team</a><span class="date">April 14, 2010<span></div></div>

<div class="blog" id="blog-content">
	<div class="interview">
		<div class="intro">
			<p><em><a href="http://jjlindal.net/jafl/blog/">John Lindal</a> (<a href="http://twitter.com/jafl5272/">@jafl5272</a> on twitter) is one of the lead engineers constructing the foundation on which <a href="http://apt.yahoo.com/">Yahoo! APT</a> is built. Previously, he worked on the Yahoo! Publisher Network.</em></div> </div>
	<p>Daniel Barreiro's recent post about nested tables reminded me that it was about time I finished my "treeble" widget. "Treeble" comes from merging "tree" and "table." The original motivation was to enable drilling into the details behind each row in a table, e.g., start with a table which displays sales figures for each continent and then drill into each country, region, and city. Of course, once I started building it, the natural design was to support any hierarchy of data. As an example, it can display a tree like this:<p><a href="http://jafl.github.com/yui2/treeble/"><img src="http://jafl.github.com/yui2/treeble/example_all.png" /></a><p>(Click the screenshot to play with this example.)<h3>Overview</h3>
	<p>The treeble widget consists of two parts. The first is a small extension to YUI DataTable for opening/closing nodes in the tree. (This is done by augmenting DataTable in order to allow it to work transparently with existing extensions to DataTable, most notably ScrollingDataTable.) The second part of treeble is a significant extension to YUI DataSource, called TreebleDataSource, which merges the results from simple, flat data sources. The tree is built dynamically, so you don't have to load all your data at once.<p>The tricky part is paginating the tree: knowing the subset of nodes which have been opened, request only the visible items. TreebleDataSource provides two options:<ol>
			<li>Paginate top-level nodes only, so all their children can be visible on the same page (the default)<li>Paginate so a fixed number of nodes are visible</ol> <p>#1 is ideal when the tree is shallow and there are only a few children per node. #2 is necessary when there may be a very large number of children per node. The configuration option that controls this behavior is <code>paginateChildren</code>. <strong>In order for pagination to work, the total number of items available from each simple data source must not change.</strong><p>Since all the items from all the simple data sources are displayed in a single table with a single set of columns, <strong>the schema given to DataTable must be the union of all the flat data source schemas</strong>. For example, in the above screenshot, DataTable must have a column for <q>Quantity</q> even though it is only defined for the leaf nodes.<p>Obviously, rows in the table no longer map directly to records in the simple data sources. Instead, each record in the DataTable has three special members:<dl>
			<dt><code>_yui_node_ds</code><dd>
				<p style="margin:0">The DataSource from which the record was retrieved. If you allow inline editing, this tells you which DataSource to use when saving the new value. (You can edit the Quantity column in the <a href="http://jafl.github.com/yui2/treeble/">live example</a>.)<dt><code>_yui_node_depth</code><dd>
				<p style="margin:0">The depth of the node in the tree. Top-level nodes have depth zero. This is useful when indenting child nodes, as in the above screenshot.<dt><code>_yui_node_path</code><dd>
				<p style="margin:0">Array of node indices leading to the record. For example, <code>[2,5,1]</code> translates to <q>second child of the sixth child of the third top-level node.</q> <code>DataTable.rowIsOpen()</code> and <code>DataTable.toggleRow()</code> require this array to identify the node.</dl> <p>The YUIDoc for TreebleDataSource and the extensions to DataTable is <a href="http://jafl.github.com/yui2/treeble/yuidoc/">here</a>.<h3>Configuring DataTable</h3>
	<p>To work with TreebleDataSource, your YUI DataTable must be configured correctly:<pre>
var myDataSource = new YAHOO.util.TreebleDataSource(...);
var myDataTable = new YAHOO.widget.DataTable(container, columns, myDataSource,
{
  dynamicData:true,
  generateRequest: YAHOO.widget.DataTable.generateTreebleDataSourceRequest,
  displayAllRecords: <em>the opposite of your TreebleDataSource's paginateChildren value</em>,
  <em>other configuration, e.g., paginator</em>
});
</pre><p>The special version of <code>generateRequest</code> is required because TreebleDataSource needs to receive a known data format so it can correctly generate the requests to the individual simple data sources.<h3>Constructing TreebleDataSource</h3>
	<p>When you construct TreebleDataSource, you must pass it an instance of YUI DataSource as <code>oLiveData</code>. One column in the data schema for this data source must have its parser set to either <code>"datasource"</code> or a custom parsing function which does the same job: construct a new YUI DataSource from the value in the column. The default data source parser ignores falsey values and constructs a data source from any truthy value, e.g., an array of objects, an XHR URL, or an object which defines <code>dataType</code> and <code>liveData</code>. The configuration (including <code>responseSchema</code> and <code>treebleConfig</code>) for the new data source is copied from the parent data source. Writing a custom datasource parser is discussed later in this post.<p>TreebleDataSource itself has only one configuration parameter, <code>paginateChildren</code>, which controls the pagination behavior, as discussed earlier. The majority of the treeble-related configuration is set on the simple data sources via the <code>treebleConfig</code> object. This allows the configuration to be different for each simple data source, as discussed below in the section on mixed data sources.<h4>Using local DataSources</h4>
	<p>The <a href="http://jafl.github.com/yui2/treeble/">live example</a> demonstrates how to work with local DataSources. The only required values in <code>treebleConfig</code> are <code>generateRequest</code> and <code>totalRecordsReturnExpr</code>:<pre>
new LocalDataSource(<em>array</em>,
{
  ...,
  treebleConfig:
  {
    totalRecordsReturnExpr: '.meta.totalRecords',
    generateRequest: function(state, path)
    {
      return state;
    }
  }
});
</pre><p>Since LocalDataSource ignores all request parameters, <code>generateRequest</code> could actually return null, but it echoes the state object instead to support extensions which can sort the data.<p>Setting <code>totalRecordsReturnExpr</code> signals TreebleDataSource that the simple data source will return all its records, not just the requested slice. The actual value of <code>totalRecordsReturnExpr</code> must be an <a href="http://en.wikipedia.org/wiki/OGNL">OGNL</a> expression specifying where in the <code>oParsedResponse</code> object returned by TreebleDataSource to store the total number of visible nodes, based on which nodes are currently open. In the example, this is <code>oParsedResponse.meta.totalRecords</code>. Since DataTable has (and must have!) <code>dynamicData</code> set to <code>true</code>, the live example also overrides <code>DataTable.handleDataReturnPayload</code> to set <code>oPayload.totalRecords=oParsedResponse.meta.totalRecords</code>. This gives the paginator the information it needs to compute the total number of pages.<h4>Using XHR DataSources</h4>
	<p>An example configuration when using XHR DataSources would be to construct the top-level data source as:<pre>
new XHRDataSource(<em>url</em>,
{
  ...,
  treebleConfig:
  {
    startIndexExpr: '.meta.startIndex',
    totalRecordsExpr: '.meta.totalRecords',
    generateRequest: function(state, path)
    {
      return 'path='+path.join(',')+
                 '&amp;startIndex='+state.startIndex+
                 '&amp;results='+state.results+
                 '&amp;sort='+state.sort+
                 '&amp;dir='+state.dir;
    }
  }
});
</pre><p>In this example, <code>generateRequest</code> returns query args which the server will interpret in order to return the appropriately sorted slice of the children of the node specified by <code>path</code>.<p>The value of <code>startIndexExpr</code> is an <a href="http://en.wikipedia.org/wiki/OGNL">OGNL</a> expression specifying where in the <code>oParsedResponse</code> object returned by the simple data source the index of the first returned node is stored. In the example, this is <code>oParsedResponse.meta.startIndex</code>.<p>The value of <code>totalRecordsExpr</code> is an <a href="http://en.wikipedia.org/wiki/OGNL">OGNL</a> expression specifying where in <code>oParsedResponse</code> the total number of nodes is stored. In the example, this is <code>oParsedResponse.meta.totalRecords</code>. <code>totalRecordsExpr</code> also specifies where in the <code>oParsedResponse</code> object returned by TreebleDataSource to store the total number of visible nodes, based on which nodes are currently open.<p>Since DataTable has (and must have!) <code>dynamicData</code> set to <code>true</code>, you would also have to override <code>DataTable.handleDataReturnPayload</code> to set <code>oPayload.totalRecords=oParsedResponse.meta.totalRecords</code>. This gives the paginator the information it needs to compute the total number of pages.<h4>Using Mixed DataSources</h4>
	<p>TreebleDataSource does not require that all the simple data sources be the same type. For example, if you have a large number of top-level nodes, but only a small tree of children for each node, then it makes sense to return the entire tree when a top-level node is opened. The default data source parser actually handles this automagically if you specify <code>startIndexExpr</code>, <code>totalRecordsExpr</code>, and <code>totalRecordsReturnExpr</code> for the top-level data source!<p>If you have only a few top-level nodes, but each tree of children is huge, then your top-level data source could use local data, and you could build a custom data source parser which instantiates XHR data sources for the children, setting <code>startIndexExpr</code>, <code>totalRecordsExpr</code>, and <code>generateRequest</code> appropriately.<p>You are only limited by your ability to comprehend the complexity of the system!<p>Note that, when using a custom data source parser, you must define <code>childNodesKey</code> in <code>treebleConfig</code> for each simple data source so TreebleDataSource knows the name of the data source column. (When you use the default parser, this is detected automatically.)</div>



	<div class="navigation">
		<div class="next-posts"></div>
		<div class="prev-posts"></div>
	</div>


			</div>
		</div>
    </div>




<div id="sidebar" class="yui3-u-1-4"><div class="liner">

        <div id="recent-posts-3" class="sidebox widget widget_recent_entries">		<div class="hd"><h2>Recent Posts</h2></div><div class="bd">		<ul>
					<li>
				<a href="/blog/2014/08/25/weve-moved-to-tumblr/">Weâ€™ve Moved to Tumblr!</a>
						</li>
					<li>
				<a href="/blog/2014/06/16/yui-gallery-deprecation-announcement/">YUI Gallery Deprecation Announcement</a>
						</li>
					<li>
				<a href="/blog/2014/06/03/yui-3-17-2-released/">YUI 3.17.2 Released</a>
						</li>
					<li>
				<a href="/blog/2014/05/23/yui-3-17-2-release-candidate-1/">YUI 3.17.2 Release Candidate 1</a>
						</li>
					<li>
				<a href="/blog/2014/05/21/yui-3-17-1-released/">YUI 3.17.1 Released</a>
						</li>
				</ul>
		</div></div><div id="archives-3" class="sidebox widget widget_archive"><div class="hd"><h2>Archives</h2></div><div class="bd">		<select name="archive-dropdown" onchange='document.location.href=this.options[this.selectedIndex].value;'>
			<option value="">Select Month</option>

				<option value='/blog/2014/08/'> August 2014 </option>
	<option value='/blog/2014/06/'> June 2014 </option>
	<option value='/blog/2014/05/'> May 2014 </option>
	<option value='/blog/2014/04/'> April 2014 </option>
	<option value='/blog/2014/03/'> March 2014 </option>
	<option value='/blog/2014/02/'> February 2014 </option>
	<option value='/blog/2014/01/'> January 2014 </option>
	<option value='/blog/2013/12/'> December 2013 </option>
	<option value='/blog/2013/11/'> November 2013 </option>
	<option value='/blog/2013/10/'> October 2013 </option>
	<option value='/blog/2013/09/'> September 2013 </option>
	<option value='/blog/2013/08/'> August 2013 </option>
	<option value='/blog/2013/07/'> July 2013 </option>
	<option value='/blog/2013/06/'> June 2013 </option>
	<option value='/blog/2013/05/'> May 2013 </option>
	<option value='/blog/2013/04/'> April 2013 </option>
	<option value='/blog/2013/03/'> March 2013 </option>
	<option value='/blog/2013/02/'> February 2013 </option>
	<option value='/blog/2013/01/'> January 2013 </option>
	<option value='/blog/2012/12/'> December 2012 </option>
	<option value='/blog/2012/11/'> November 2012 </option>
	<option value='/blog/2012/10/'> October 2012 </option>
	<option value='/blog/2012/09/'> September 2012 </option>
	<option value='/blog/2012/08/'> August 2012 </option>
	<option value='/blog/2012/07/'> July 2012 </option>
	<option value='/blog/2012/06/'> June 2012 </option>
	<option value='/blog/2012/05/'> May 2012 </option>
	<option value='/blog/2012/04/'> April 2012 </option>
	<option value='/blog/2012/03/'> March 2012 </option>
	<option value='/blog/2012/02/'> February 2012 </option>
	<option value='/blog/2012/01/'> January 2012 </option>
	<option value='/blog/2011/12/'> December 2011 </option>
	<option value='/blog/2011/11/'> November 2011 </option>
	<option value='/blog/2011/10/'> October 2011 </option>
	<option value='/blog/2011/09/'> September 2011 </option>
	<option value='/blog/2011/08/'> August 2011 </option>
	<option value='/blog/2011/07/'> July 2011 </option>
	<option value='/blog/2011/06/'> June 2011 </option>
	<option value='/blog/2011/05/'> May 2011 </option>
	<option value='/blog/2011/04/'> April 2011 </option>
	<option value='/blog/2011/03/'> March 2011 </option>
	<option value='/blog/2011/02/'> February 2011 </option>
	<option value='/blog/2011/01/'> January 2011 </option>
	<option value='/blog/2010/12/'> December 2010 </option>
	<option value='/blog/2010/11/'> November 2010 </option>
	<option value='/blog/2010/10/'> October 2010 </option>
	<option value='/blog/2010/09/'> September 2010 </option>
	<option value='/blog/2010/08/'> August 2010 </option>
	<option value='/blog/2010/07/'> July 2010 </option>
	<option value='/blog/2010/06/'> June 2010 </option>
	<option value='/blog/2010/05/'> May 2010 </option>
	<option value='/blog/2010/04/'> April 2010 </option>
	<option value='/blog/2010/03/'> March 2010 </option>
	<option value='/blog/2010/02/'> February 2010 </option>
	<option value='/blog/2010/01/'> January 2010 </option>
	<option value='/blog/2009/12/'> December 2009 </option>
	<option value='/blog/2009/11/'> November 2009 </option>
	<option value='/blog/2009/10/'> October 2009 </option>
	<option value='/blog/2009/09/'> September 2009 </option>
	<option value='/blog/2009/08/'> August 2009 </option>
	<option value='/blog/2009/07/'> July 2009 </option>
	<option value='/blog/2009/06/'> June 2009 </option>
	<option value='/blog/2009/05/'> May 2009 </option>
	<option value='/blog/2009/04/'> April 2009 </option>
	<option value='/blog/2009/03/'> March 2009 </option>
	<option value='/blog/2009/02/'> February 2009 </option>
	<option value='/blog/2009/01/'> January 2009 </option>
	<option value='/blog/2008/12/'> December 2008 </option>
	<option value='/blog/2008/11/'> November 2008 </option>
	<option value='/blog/2008/10/'> October 2008 </option>
	<option value='/blog/2008/09/'> September 2008 </option>
	<option value='/blog/2008/08/'> August 2008 </option>
	<option value='/blog/2008/07/'> July 2008 </option>
	<option value='/blog/2008/06/'> June 2008 </option>
	<option value='/blog/2008/05/'> May 2008 </option>
	<option value='/blog/2008/04/'> April 2008 </option>
	<option value='/blog/2008/03/'> March 2008 </option>
	<option value='/blog/2008/02/'> February 2008 </option>
	<option value='/blog/2008/01/'> January 2008 </option>
	<option value='/blog/2007/12/'> December 2007 </option>
	<option value='/blog/2007/11/'> November 2007 </option>
	<option value='/blog/2007/10/'> October 2007 </option>
	<option value='/blog/2007/09/'> September 2007 </option>
	<option value='/blog/2007/08/'> August 2007 </option>
	<option value='/blog/2007/07/'> July 2007 </option>
	<option value='/blog/2007/06/'> June 2007 </option>
	<option value='/blog/2007/05/'> May 2007 </option>
	<option value='/blog/2007/04/'> April 2007 </option>
	<option value='/blog/2007/03/'> March 2007 </option>
	<option value='/blog/2007/02/'> February 2007 </option>
	<option value='/blog/2007/01/'> January 2007 </option>
	<option value='/blog/2006/12/'> December 2006 </option>
	<option value='/blog/2006/11/'> November 2006 </option>
	<option value='/blog/2006/10/'> October 2006 </option>
	<option value='/blog/2006/09/'> September 2006 </option>
	<option value='/blog/2006/08/'> August 2006 </option>
	<option value='/blog/2006/07/'> July 2006 </option>
	<option value='/blog/2006/06/'> June 2006 </option>
	<option value='/blog/2006/05/'> May 2006 </option>
	<option value='/blog/2006/04/'> April 2006 </option>
	<option value='/blog/2006/03/'> March 2006 </option>
	<option value='/blog/2006/02/'> February 2006 </option>
		</select>
</div></div><div id="categories-2" class="sidebox widget widget_categories"><div class="hd"><h2>Categories</h2></div><div class="bd">		<ul>
	<li class="cat-item cat-item-69"><a href="/blog/category/accessibility/" >Accessibility</a> (25)
</li>
	<li class="cat-item cat-item-524"><a href="/blog/category/css-101/" >CSS 101</a> (8)
</li>
	<li class="cat-item cat-item-1"><a href="/blog/category/design/" title="This category is for design related posts. For example, all posts about the design pattern library belong here.">Design</a> (51)
</li>
	<li class="cat-item cat-item-2"><a href="/blog/category/development/" title="For development related posts, including all posts about the Yahoo! User Interface Library.">Development</a> (653)
</li>
	<li class="cat-item cat-item-219"><a href="/blog/category/frontend-engineering-jobs-at-yahoo/" >Frontend Jobs at Yahoo</a> (13)
</li>
	<li class="cat-item cat-item-96"><a href="/blog/category/graded-browser-support/" >Graded Browser Support</a> (8)
</li>
	<li class="cat-item cat-item-11"><a href="/blog/category/in-the-wild/" title="In which we mention and link to third-party tutorials, discussions, comments, feedback, and implementations.">In the Wild</a> (63)
</li>
	<li class="cat-item cat-item-403"><a href="/blog/category/miscellany/" >Miscellany</a> (13)
</li>
	<li class="cat-item cat-item-483"><a href="/blog/category/open-hours/" >Open Hours</a> (44)
</li>
	<li class="cat-item cat-item-13"><a href="/blog/category/performance/" >Performance</a> (23)
</li>
	<li class="cat-item cat-item-598"><a href="/blog/category/releases/" >Releases</a> (50)
</li>
	<li class="cat-item cat-item-592"><a href="/blog/category/target-environments/" >Target Environments</a> (11)
</li>
	<li class="cat-item cat-item-599"><a href="/blog/category/yeti-development/" >Yeti</a> (5)
</li>
	<li class="cat-item cat-item-292"><a href="/blog/category/yui-3-gallery/" >YUI 3 Gallery</a> (34)
</li>
	<li class="cat-item cat-item-286"><a href="/blog/category/yui-events/" >YUI Events</a> (48)
</li>
	<li class="cat-item cat-item-8"><a href="/blog/category/yui-implementations/" >YUI Implementations</a> (55)
</li>
	<li class="cat-item cat-item-9"><a href="/blog/category/yui-theater/" >YUI Theater</a> (164)
</li>
	<li class="cat-item cat-item-595"><a href="/blog/category/yui-weekly/" >YUI Weekly</a> (76)
</li>
	<li class="cat-item cat-item-602"><a href="/blog/category/yui-conf/" title="Posts pertaining to YUIConf - videos, notices, updates.">YUIConf</a> (27)
</li>
		</ul>
</div></div>

</div></div>
		</div><!-- /#bd -->
		<div id="ft">
			<footer>
				<div class="copyright">
			&copy; 2014 YUI Blog				</div>
			</footer></div></div><!-- /#doc -->

</body>
</html>
