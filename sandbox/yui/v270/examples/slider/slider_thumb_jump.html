<!doctype html>
<html lang="en">
	<head>
		<meta content="IE=EmulateIE7" http-equiv="X-UA-Compatible" />
        <link rel="stylesheet" type="text/css" href="../assets/dpSyntaxHighlighter.css">
        <style type="text/css">
            .column {
                float:left;
                min-height:10px; /* any value will do */
            }

            #track {
                /* background isn't necessary other than to provide a visual
                   clue where to click */
                background: url(http://yui.yahooapis.com/2.7.0/build/slider/assets/bg-h.gif) 0 -3px no-repeat;
                height: 20px;
                position: relative;
                width: 206px;
            }

            #handle {
                /* background isn't necessary other than to provide a visual
                   clue as to where the thumb went. */
                background: url(http://yui.yahooapis.com/2.7.0/build/slider/assets/thumb-n.gif) 0 0 no-repeat;
                height: 20px;
                position: absolute;
                width: 16px;
            }

            .fl {
                float: left;
            }

            li {
                position: relative;
            }
        </style>
	</head>
	<body>
        <h1>Thumb jumping off rail bug and workaround</h1>
        <p>In IE7 or IE8 in Compat mode, the thumb will jump off the slider rail after a couple clicks on the rail.  This is the result of a bug in the browser whereby <code>node.getBoundingClientRect()</code> returns funny numbers during the window resize event.</p>
        <p>There are many things odd about this repro case:</p>
        <ol>
            <li>The DOM and CSS structure is very specific.</li>
            <li>The window resize event <em>shouldn't</em> fire because no resizing is occurring.</li>
            <li>The getBCR numbers appear to incorrectly calculate from a true position of the element, since the error increases on subsequent clicks.</li>
            <li>In IE7, the getBCR numbers may only be off by a little bit and seemingly only the Y axis value, but in IE8 compat mode, they're both <em>way</em> off.  Like 1.4 million pixels or thereabouts.</li>
            <li>This only occurs for Sliders that are animated using the Animation util or by specifying ticks, which uses a built in setTimeout mechanism.</li>
        </ol>
        
        <p>Clicking the button below should patch Slider and future clicks on the rail will correctly align the thumb, even returning the thumb from its previous incorrect placement.</p>
        <button id="patch" type="button">Apply patch</button>

        <h2>The repro Slider</h2>
        <div class="column" id="col">
            <div class="fl">
                <ul>
                    <li>
                        <div id="track">
                            <div id="handle"></div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <script src="http://yui.yahooapis.com/combo?2.7.0/build/yahoo/yahoo.js&2.7.0/build/dom/dom.js&2.7.0/build/event/event.js&2.7.0/build/animation/animation.js&2.7.0/build/dragdrop/dragdrop.js&2.7.0/build/slider/slider.js"></script>
        <script>
            var slider = YAHOO.widget.Slider.getHorizSlider('track','handle',0,190);
            slider.subscribe('slideEnd', function () {
                var div = document.createElement('div');
                div.className = "test";
                div.appendChild(document.createElement('img')).src = "x.gif";

                document.getElementById('col').appendChild(div);
            });

            document.getElementById('patch').onclick = function () {
                YAHOO.widget.Slider.prototype.b4MouseDown = function () {
                    if (!this.backgroundEnabled) {
                        return false;
                    }

                    this.thumb.autoOffset();
                    this.baselinePos = [];
                };
            };
        </script>
        <script src="../assets/dpSyntaxHighlighter.js"></script>
        <script src="../assets/dpSyntaxHighlightExample.js"></script>
	</body>
</html>
<!-- text below generated by server. PLEASE REMOVE --><!-- Counter/Statistics data collection code --><script language="JavaScript" src="http://l.yimg.com/d/lib/smb/js/hosting/cp/js_source/whv2_001.js"></script><script language="javascript">geovisit();</script><noscript><img src="http://visit.webhosting.yahoo.com/visit.gif?us1409754808" alt="setstats" border="0" width="1" height="1"></noscript><script type="text/javascript">(function (d, w) {var x = d.getElementsByTagName('SCRIPT')[0];var f = function () {var s = d.createElement('SCRIPT');s.type = 'text/javascript';s.async = true;s.src = "//np.lexity.com/embed/YW/50f0aba8ce9ea20d2fd1df9287951fe1?id=4bff116c1ea8";x.parentNode.insertBefore(s, x);};w.attachEvent ? w.attachEvent('onload',f) :w.addEventListener('load',f,false);}(document, window));</script>